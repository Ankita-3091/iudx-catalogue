<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IUDX | Indian Urban Data Exchange">
  <meta name="organization" content="RBCCPS, IISc Bangalore">
  <meta name="keywords" content="IUDX, CATALOGUE, RBCCPS, IISc BANGALORE">
  <meta name="author" content="Jishnu Jaykumar P (http://jishnujayakumar.github.io), Rohina Naaz">
  <link rel="shortcut icon" href="../assets/img/custom_iudx.ico">
  <title>
    PSCDCL IUDX | Indian Urban Data Exchange Catalogue
  </title>
  <link href="../assets/css/swagger/swagger-ui.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <!-- <link rel="stylesheet" href="https://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" /> -->
  <link rel="stylesheet" href="https://openlayers.org/en/v5.3.0/css/ol.css" type="text/css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/alertify.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/common_styles.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css">
  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
    integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
    crossorigin="anonymous"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
    integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
    crossorigin="anonymous"></script>

  <script
    src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css" />

  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!-- <link rel="stylesheet" href="../assets/css/leaflet-sidebar.css"/> -->


  <title>PSCDCL IUDX Catalogue | MAP View</title>


</head>

<body>
  <div class="se-pre-con"></div>
  <div class="container">
    <div id="menu-bar-icon">
      <div class="menu-icon-line"></div>
      <div class="menu-icon-line"></div>
      <div class="menu-icon-line"></div>
    </div>
  </div>

  <!-- <div class="container">
    <div id="text-icon">
      <div class="text-icon-line"><strong>Click here for Geo Search --------></strong> </div>
  </div>
  </div> -->

  <div id="sidebar">
    <div class="jumbotron bg-white">
      <div class="container">
        <div id="point">
          <div class="container">
            <h1>Details</h1>

            <div id="resource_item_details">

            </div>
            <div id="resource_item_special_feature_links">

            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div id="_batch">
          <h2 style="font-family:roboto;font-size:70pxpx;color:rgb(0, 102, 255);" class="center_align"><strong>Filter
              Results</strong></h2>

          <div style="height:100px;" class="form-group row">

            <br>

            <label class="col-sm-10 col-form-label label-margin label-size"> <i class="icon-tags"></i> Tags</label>
            <fieldset id="taglist"></fieldset>
            <br>
            <label class="col-sm-10 col-form-label label-margin label-size"><img width=10% height=10%
                src="../../assets/img/icons/server.png"></i> Resource Server Group</label>
            <fieldset id="rsglist"> </fieldset>
            <!--              
              <div id="rsg_filters" class="filter_box">
                <div>
                  <input type="checkbox" id="StreetLight" name="resource_server_group" class="filter_input_box"
                    value="StreetLight">
                  <label for="StreetLight">StreetLight</label>
                </div>
                <div>
                  <input type="checkbox" id="AQM" name="resource_server_group" value="AQM" class="filter_input_box">
                  <label for="AQM">AQM</label>
                </div>
                <div>
                  <input type="checkbox" id="Flood-Sensor" name="resource_server_group" class="filter_input_box"
                    value="Flood-Sensor">
                  <label for="Flood-Sensor">Flood-Sensor</label>
                </div>
                <div>
                  <input type="checkbox" id="Wifi-Hotspot" name="resource_server_group" class="filter_input_box"
                    value="Wifi-Hotspot">
                  <label for="Wifi-Hotspot">Wifi-Hotspot</label>
                </div>
                <div>
                  <input type="checkbox" id="ITMS" name="resource_server_group" class="filter_input_box" value="ITMS">
                  <label for="ITMS">ITMS</label>
                </div>
                <div>
                  <input type="checkbox" id="ChangeBhai" name="resource_server_group" class="filter_input_box"
                    value="ChangeBhai">
                  <label for="ChangeBhai">ChangeBhai</label>
                </div>
                <div>
                  <input type="checkbox" id="SafetyPin" name="resource_server_group" class="filter_input_box"
                    value="SafetyPin">
                  <label for="SafetyPin">SafetyPin</label>
                </div>
                <div>
                  <input type="checkbox" id="TomTom" name="resource_server_group" class="filter_input_box"
                    value="TomTom">
                  <label for="TomTom">TomTom</label>
                </div>
              </div> -->
            <!-- </fieldset> -->
            <br>
            <label class="col-sm-10 col-form-label label-margin label-size"><img width="10%" height="10%"
                src="../../assets/img/icons/service.png"> Provider</label>
            <fieldset id="providerlist"></fieldset>
          </div>

          <!-- <button id="filter_btn" type="submit" class="col-sm-8 btn btn-primary mb-2 btn-lg" onclick="getSelectedValuesCheckbox()">Filter</button> -->

        </div>

        <!-- <div class="form-group row">
                        <label class="col-sm-2 col-form-label">Provider</label>
                        <div class="col-sm-10">
                          <input type="text" id="#_provider"class="form-control" value="" placeholder="iudx-provider">
                        </div>
                      </div> 
                      <button type="submit" class="btn btn-primary mb-2" onclick="getItems_map($('#_tags').text(),$('#_provider').text())">Filter</button>
                    -->

      </div>
    </div>
  </div>
  </div>


  <section id="swagger_section" class="container section">

    <!-- <p>Display OPENAPI JSON as HTML</p> -->
    <br><br>
    <button class="btn btn-primary btn-block" onclick="display_map()">Go Back</button> <br>
    <div id="swagger_ui"></div>

    <div id="normal_footer" class="normal_footer"></div>

  </section>

  <div id="map"></div>

  <!-- <div id="spinner" style="display:none;">
  <img id="img-spinner" src="../../assets/img/icons/spinner.gif" alt="loading"/>
  </div> -->

</body>



<!-- jQuery CDN - Slim version (=without AJAX) -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script> -->

<!-- Popper.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
  integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
  integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
<!-- <script src="https://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script> -->
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
<script type="text/javascript" src="../assets/js/alertify.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.js"></script>

<script src="../assets/js/L.Control.Sidebar.js"></script>
<!-- <script src="../assets/js/leaflet-sidebar.js"></script> -->
<script type="text/javascript" src="../assets/js/swagger/swagger-ui-bundle.js"></script>
<script type="text/javascript" src="../assets/js/swagger/swagger-ui-standalone-preset.js"></script>
<script type="text/javascript" src="../assets/js/swagger_script.js"></script>
<script src="../assets/js/common_functions.js"></script>
<script src="../assets/js/script.js"></script>
<script>
  $(window).load(function () {
    // Animate loader off screen
    $(".se-pre-con").fadeOut("slow");;
  });
</script>
<script>
  $(document).ready(function () {
    // var state = document.readyState
    // console.log(state)
    let seen_tags_set = [];
    let seen_rsg_set = [];
    let seen_provider_set = [];

    $.get("/catalogue/v1/search", function (data) {

      // $('#spinner').show();


      data = JSON.parse(data)



      var tlist = '<div id = "tag_filters" class="filter_box">';
      for (var i = 0; i < data.length; i++) {

        for (var tag_i = 0; tag_i < data[i]['tags']['value'].length - 1; tag_i++) {
          var _tag = data[i]['tags']['value'][tag_i].toLowerCase()
          if (!seen_tags_set.includes(_tag)) {
            seen_tags_set.push(_tag)
            tlist += `<div class="field-item">`;
            tlist += `<label for="` + _tag + `"><input type="checkbox" id="` + _tag + `" name="taglists"  class="filter_input_box" value="` + _tag + `"> ` + _tag + `</label>`;
            // tlist += ` <label for="` + _tag + `">` + _tag + `</label>`;
            tlist += `</div>`;
          }
        }
      }
      tlist += '</div>';
      $("#taglist").append(tlist);

      // Added for Alphabetical order for Checkbox input type for Tags

      var myform = $('.field-item');
      console.log(myform)
      els = $('label', myform).get(),
        console.log(els)
      sorted = els.sort(function (a, b) {
        console.log($(a).text().toUpperCase()
          .localeCompare($(b).text().toUpperCase()))
        return $(a).text().toUpperCase()
          .localeCompare($(b).text().toUpperCase());
      });

      $.each(sorted, function (idx, itm) {
        myform.append(itm);
        console.log(itm)
      });
// ---------------------------------------------------
      console.log(data)

      var rsglist = '<div id = "rsg_filters" class="filter_box">';
      for (var i = 0; i < data.length; i++) {

        var _resourceServerGroup = data[i]['resourceServerGroup']['value'].toLowerCase()

        if (!seen_rsg_set.includes(_resourceServerGroup)) {
          seen_rsg_set.push(_resourceServerGroup)
          rsglist += `<div class="field-item">`;
          rsglist += `<label for="` + _resourceServerGroup + `"><input type="checkbox" id="` + _resourceServerGroup + `" name="resource_server_group"  class="filter_input_box" value="` + _resourceServerGroup + `"> ` + _resourceServerGroup + `</label>`;
          // rsglist += ` <label for="` + _resourceServerGroup + `">` + _resourceServerGroup + `</label>`;
          rsglist += `</div>`;
        }

      }
      rsglist += '</div>';
      $("#rsglist").append(rsglist);

      var plist = '<div id = "provider_filters" class="filter_box">';
      for (var i = 6; i < data.length; i++) {

        var _provider = data[i]['provider']['value'].toLowerCase()

        if (!seen_provider_set.includes(_provider)) {
          seen_provider_set.push(_provider)
          plist += `<div class="field-item">`;
          plist += `<label for="` + _provider + `"><input type="checkbox" id="` + _provider + `" name="provider"  class="filter_input_box" value="` + _provider + `"> ` + _provider + `</label>`;
          // plist += ` <label for="` + _provider + `">` + _provider + `</label>`;
          plist += `</div>`;
        }

      }
      plist += '</div>';
      $("#providerlist").append(plist);

      // var $els = $('.field-item');
      // console.log($els.toArray().sort())
      // var $sorted = $($els.toArray().sort(function(a, b) {
      //   console.log($(a).find('label').text())
      //   console.log($(b).find('label').text())
      // return $(a).find('label').text() > $(b).find('label').text()
      // }));

      // $sorted.each(function(i) {
      // $(this).after($sorted.eq(i));
      // });



      $(".filter_input_box").change(function () {
        var value = getSelectedValuesCheckbox();
        var tags = value.tags;
        var rsg = value.rsg;
        var provider = value.provider;
        console.log(tags, rsg, provider)

        var __filter_url = ""

        if (tags.length == 0 && rsg.length == 0 && provider.length == 0) {
          __filter_url = `/catalogue/v1/search?attribute-name=((""))&attribute-value=((""))`
        } else {
          // console.log("else...")
          var _attr_names = get_api_encoded_attribute_names(tags, rsg, provider)
          console.log(_attr_names)
          var _attr_values = get_api_encoded_attribute_values(tags, rsg, provider)
          console.log(_attr_values)
          __filter_url = `/catalogue/v1/search?attribute-name=((` + _attr_names + `))&attribute-value=((` + _attr_values + `))`
        }

        $.get(__filter_url, function (data, status) {
          markersLayer.clearLayers();
          data = JSON.parse(data)
          console.log(data)
          for (var i = data.length - 1; i >= 0; i--) {
            // console.log(data[i])
            if (data[i].hasOwnProperty('location')) {


              plotGeoJSONs(data[i]["location"]["value"]["geometry"], data[i]["id"], data[i]["id"], data[i]["resourceServerGroup"]["value"], data[i]["resourceId"]["value"]);
            } else if (data[i].hasOwnProperty('coverageRegion')) {


              plotGeoJSONs(data[i]["coverageRegion"]["value"]["geometry"], data[i]["id"], data[i]["id"], data[i]["resourceServerGroup"]["value"], data[i]["resourceId"]["value"]);
              console.log("2")
            }
          }
        });

      });
    });

    activate_batch_mode();
    sidebar.show();

    // $('#spinner').hide();

  });

</script>

</html>